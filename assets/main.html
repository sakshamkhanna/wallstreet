<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Wallstreet login">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/css/materialize.min.css">
  	<link rel="stylesheet" type="text/css" href="css/style.css">
	<title>WallStreet | Main</title>
</head>
<body class="mainbody">
	<nav>
	<div class="nav-wrapper teal lighten-1">
      <a href="#" class="brand-logo center">WallStreet</a>
	<ul class="hide-on-med-and-down">
	    <li><img src="image/TTlogo.png" alt=""></li>
  	</ul>
  <ul style="    position: absolute;
    height: 98vh;
    top: 65px;" id="slide-out" class="side-nav fixed">
      <li class="bold"><a href="#!" class="waves-effect waves-teal center">Welcome <span id="userName"></span></a></li>
      <a class="waves-effect waves-light modal-trigger" href="#rules">Help</a>
      <ul class="collapsible black-text" data-collapsible="accordion">
	    <li>
	      <div class="collapsible-header" class="listoflb">Leaderboard</div>
	      <div class="collapsible-body">
	      	 <ul class="collection">
			      <!--<li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>-->
		     </ul>
	      </div>
	    </li>
	    <li>
	      <div class="collapsible-header" class="listofrel">Relative Position</div>
	      <div class="collapsible-body">
	      	 <ul class="collection">
		      <!--<li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>-->
		    </ul>
	      </div>
	    </li>
	    <li>
	      <div class="collapsible-header" class="listoftopstocks">Top Stocks</div>
	      <div class="collapsible-body">
	      	<ul class="collection">
		      <!--<li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>-->
		    </ul>
	      </div>
	    </li>
	    <li>
	      <div class="collapsible-header" class="listoftopinv">Top Investors</div>
	      <div class="collapsible-body">
	      	<ul class="collection">
		      <!--<li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>
			      <li class="collection-item center">Alvin</li>-->
		    </ul>
	      </div>
	    </li>
	  </ul>
</ul>
  	<a href="#" data-activates="slide-out" class="button-collapse"><i class="material-icons">menu</i></a>
	</nav>
	<main>
		<div class="myContainer">
		<div class="row">
			<p><b>Liquid Cash: <span id="liquidCash"></span> </b></p>
		</div>
		<div class="row">
			<p><b>Worth: <span id="worth"></span></b></p>
		</div>
		<div class="row">
	    <div class="col s12">
	      <ul class="tabs">
	        <li class="tab col s4"><a  class="active" href="#stocks" class="classforstocks" >All Stocks</a></li>
	        <li class="tab col s4"><a href="#investors" class="classforinvestors">All Investors</a></li>
         	<li class="tab col s4"><a href="#transactions" class="classfortransactions">Your Stocks</a></li>
	      </ul>
	    </div>
		    <div id="stocks" class="col s12">
		    	<table class="bordered striped centered responsive-table">
		        <thead>
		          <tr>
		              <th data-field="name">Name</th>
		              <th data-field="value">Value</th>
		              <th data-field="trend">Trend</th>
		              <th data-filed="action"></th>
		          </tr>
		        </thead>
		        <tbody id="stockbody">
		          <!--<tr>
		            <td>Alvin</td>
		            <td>$0.87</td>
		            <td><i class="material-icons">keyboard_arrow_up</i></td>
		            <td>
		            	<input type="number" name="amount" placeholder="Amount" style="width:50%">
		            	<a class="waves-effect waves-light btn">Buy</a></td>
		          </tr>-->
		        </tbody>
		      </table>
		    </div>
		    <div id="investors" class="col s12">
		    	<table class="bordered striped centered responsive-table">
		        <thead>
		          <tr>
		              <th data-field="name">Name</th>
		              <th data-field="value">Value</th>
		              <th data-filed="action"></th>
		          </tr>
		        </thead>
		        <tbody id="investorbody">
							<h3>Coming soon</h3>
		          <!--<tr>
		            <td>Alvin</td>
		            <td>$0.87</td>
		            <td>
				      <input type="number" name="amount" placeholder="Amount" style="width:50%">
				      <a class="waves-effect waves-light btn">Ok</a>
		            </td>
		          </tr>-->
		        </tbody>
		      </table>
		    </div>
		    <div id="transactions" class="col s12">
		    	<table class="bordered striped centered responsive-table">
		        <thead>
							<h3>Coming soon</h3>
		          <!--<tr>
		              <th data-field="name">Name</th>
		              <th data-field="value">Value</th>
		              <th data-field="quantity">Quantity</th>
		              <th data-field="action"></th>
		              <th data-field="name">Name</th>
		              <th data-field="value">Value</th>
		          </tr>-->
		        </thead>
		        <tbody>
		          <tr>
		            <td>Alvin</td>
		            <td>$0.87</td>
		            <td>20</td>
		            <td>
				      <input type="number" name="amount" placeholder="Amount" style="width:50%">
				      <a class="waves-effect waves-light btn">Sell</a>
		            </td>
		             <td>Alvin</td>
		            <td>$0.87</td>
		          </tr>
		        </tbody>
		      </table>
		    </div>
		  </div>
		  </div>
	  </main>
	 <div id="rules" class="modal">
	    <div class="modal-content">
	      <h4>Rules</h4>
	      <p><u>INTRODUCTION:</u><br><br>
 Welcome to WallStreet 2016. The game will be running from 9pm to 1am, on each day from 12th to 14th October. At the beginning of each day, each player will be given $50,000. <b>The winner on each day would be the player with the maximum net worth.</b></p>

<p><u>RULES:</u>
<ul>
<li> There will be a list of 30 stocks that you can invest in, and the value of these stocks will be updates in real time as per NASDAQ. You can view the updated value of the stocks by refreshing the page.</li>
 <li> The player can buy and sell stocks. The player can also invest in other players i.e. you csn give some amount of money to another player, who can then use that to do further transactions, and the gain or the loss is then shared by the 2 players.<br>
i.e.<br>
Player A has $100 initially<br>
Player B invests $50 in Player A<br>
<br>
Say, amount that A has at the end of that day is $1000, so the money will be divided as,<br>
Amount to A : Amount to B = 100 : 50 <br>
i.e. |1000-100| will be divided into ratio 100:50 and be given to A and B respectively. <br>
</li>
</ul>
</p>

<p><u>GUIDE TO MAIN PAGE:</u>
<ul>
<li> Liquid Cash- The amount of money you have left to invest in stocks or in other players.</li>
<li> Value- Your worth in terms of the stocks you own and their current value.</li>
<li> All Stocks- The 30 stocks that you can invest in, with their current value and their trend. This is where you can buy stocks by entering the number of stocks you would like to buy.</li>
<li> All Investors- The list of all players who are interested in being invested in, with their current value. You can choose which player you would like to invest in, by entering the amount you would like to invest in them.</li>
<li> Your Stocks- The list of all your investments: (a) The stocks you currently own, with the number of stocks and their value. (b) The players you have invested in, with the amount you have interested in each of them.</li>
<li> Leaderboard- The list of top 10 players, with respect to their net worth.</li>
<li> Relative position- How many players are  leading and trailing with respect to your net worth.</li>
<li> Top stocks- The list of top stocks that are being dealt with.</li>
<li> Top investors- The list of top players being invested in.</li>
</ul>
</p>
	    </div>
	    <div class="modal-footer">
	      <a href="#!" class=" modal-action modal-close waves-effect waves-green btn-flat">Continue</a>
	    </div>
	  </div>
	   <footer class="page-footer teal lighten-1">
		  <div class="marquee" >
			  <div>
			    <span>Wallstreet</span>
			    <span>Wallstreet</span>
			  </div>
		</div>
	</footer>
	  <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/js/materialize.min.js"></script>
	<script type="text/javascript" src="js/script.js"></script>
	 <script type="text/javascript">
 $(function(){
	 //obtain user session variables
	 //stocks
	 $.ajax(
		 {
			 url: '/stocks/list',
			 type: 'GET',
			 success: function(data){
				 for(var i = 0; i < data.length; i++) {
						var obj = data[i];
						var trend=obj.snapshot.value>=0?'keyboard_arrow_up':'keyboard_arrow_down';
						$("#stockbody").append(
							'<tr><td>'+obj.name+'</td><td>$'+obj.snapshot.value+'</td><td><i class="material-icons">'+
								trend+
								'</i></td>'+
							'<td><input type="number" name="amount" placeholder="Amount" style="width:50%"'+
							'id="stock'+obj.symbol+'">'+
							'<a class="waves-effect waves-light btn" onclick=buyStock("'+
							obj.symbol+
							'")>Buy</a>'+
							'</td></tr>'
						);
						console.log('done!!!!');
	 var list=$("#stockbody");

	 console.log(list.html());
					}
			 }
		 }
	 );
	 //mf
	 $.ajax(
		 {
			 url: '/mf/list',
			 type: 'GET',
			 success: function(data){
				 for(var i = 0; i < data.length; i++) {
						var obj = data[i];
						$("#investorbody").append(							
		          	'<tr>'+
		            '<td>'+obj.name+'</td>'+
		            '<td>$'+obj.worth+'</td>'+
								'<td><input type="number"  class="stockVolumeInput" name="amount" placeholder="Amount" style="width:50%" id="mfplayer"'+
									'data-playerid="'+obj.id+'">'+
				      		'<a class="waves-effect waves-light btn" onclick=investMF("'+
										obj.id+
									'")>Ok</a>'+
		            '</td>'+
		          '</tr>');
						console.log('done!!!!');
					}
					console.log($("#investorbody").html());
			 }
		 }
	 );
	 //transactions
	 $.ajax(
		 {
			 url: '/mf/list',
			 type: 'GET',
			 success: function(data){
				 for(var i = 0; i < data.length; i++) {
						var obj = data[i];
						$("#transactions").append(
							'<tr><td>'+
							obj.name+
							'</td><td>'+
							obj.worth+
							'</td><td>'+
							'<input type="number" name="amount" placeholder="Amount" style="width:50%">'+
							'<a class="waves-effect waves-light btn">Ok</a>'+
							'</td></tr>'
						);
						console.log('done!!!!');
					}
			 }
		 }
	 );
 });


function updateUserDetailsPage(){
	var name = localStorage.getItem("playerName");
	var liquidCash = localStorage.getItem("playerLiquid");
	var worth = localStorage.getItem("playerWorth");
	var id = localStorage.getItem("playerId");

	var data = {id: id};

	$.get("/player/id",data,function(e){
		$("#liquidCash").html(e.liquid);
		$("#worth").html(e.worth);
	});

}

 function buyStock(sym) {
		var inp="#stock"+sym;
		var amt=$(inp)[0].value;
		console.log(amt);
		$.ajax({
			type: "POST",
			url: "/stocks/buy",
			data: {
				stockSymbol: sym,
				qty: amt
			},
			success: function(data){
				if(data.status == 1){
					alert("Transaction complete");
				}
				else{
					alert("Transaction failed");
				}
				$('.stockVolumeInput').val(" ");
			}
		});
} 
function investMF(id) {
		var invbody=$("#investorbody");
		var inp=null;
		console.log(invbody);
		for(var i = 0 ; i<inps.lenth;i++){
			console.log("-----------------------");
			console.log(inps[i].html());
			if(inps[i].data-playerid == id){
				inp=inps[i];
				break;
			}
		}
		var amt=inp.value;
		console.log(amt);
		$.ajax({
			type: "POST",
			url: "/MF/invest",
			data: {
				userid: id,
				amt: amt
			},
			success: function(data){
				console.log(data);
			}
		});
}
$(document).ready(function(e){
	updateUserDetailsPage();
});
 </script>
</body>
</html>